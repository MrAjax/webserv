<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Login</title>
    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="/admin/welcome/user_management.css">
</head>
<body>
   <div><h1>User Management</h1>
    <img src="/admin/welcome/user_management.jpg" alt="admin">
    <table class="table table-striped table-hover">
        <thead>
        <tr>
        <th>#</th>
        <th>Name</th>
        <th>Created</th>
        </tr>
        </thead>
        <tbody>
        {rows}
        </tbody>
    </table>
    </div>
    <div>
        <p>Add New User</p>
        <form action="/cgi-bin/user_create.py.cgi" method="post">
            <div>
                <input type="text" name="username" placeholder="Username" required>
            </div>
            <div>
                <input type="password" name="password" placeholder="Password" required>
            </div>
            <button type="submit" class="add-button">Add</button>
        </form>
    </div>
    <div>
        <p>Delete User</p>
        <form id="deleteUserForm">
            <div>
                <input type="text" name="username" placeholder="Username" required>
            </div>
            <button type="submit" class="delete-button">Ciao</button>
        </form>
        <script>
            document.getElementById('deleteUserForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const username = this.querySelector('[name="username"]').value;
            
                // Send a DELETE request
                fetch('/admin/welcome/delete.html', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username: username }),
                })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error('Network response was not ok.');
                })
                .then(data => {
                    console.log(data);
                    // Handle success response
                    // Maybe redirect or show a success message
                })
                .catch(error => {
                    console.error('There has been a problem with your fetch operation:', error);
                    // Handle errors here
                });
            });
            </script>            
    </div>
    <footer>
        <p><a href="/admin/welcome/admin_welcome.html">Welcome</a></p>
    </footer>
    </body>
</html>